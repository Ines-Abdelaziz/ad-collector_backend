    {% load static %}

<html>
  <head>
                    <link rel="shortcut icon" href='{% static "favicon.ico" %}' type="image/x-icon">

    <title>Advertisers</title>
<!--      <script src="//www.google.com/jsapi"></script>-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-dateFormat/1.0/jquery.dateFormat.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <style type="text/css">

        body{

          padding-bottom:70px;// You can adjust it
        }

        #tree_map text {
          pointer-events: none
        }


        .loader {
          border: 16px solid #f3f3f3;
          border-radius: 50%;
          border-top: 16px solid #3498db;
          width: 80px;
          height: 80px;
          -webkit-animation: spin 2s linear infinite;
          animation: spin 2s linear infinite;
        }
          
          .centerme {
              position: relative;
              top: 35%;
              transform: translateY(-35%);
            }


            .col-centered{
                float: none;
                margin: 0 auto;
            }

        @-webkit-keyframes spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
    </style>

    <!--<script>-->
    <!--$(document).ready(function() {-->
<!--//        hide unless login is needed-->
        <!--$('body').hide();-->
    <!--});-->

  <!--// This is called with the results from from FB.getLoginStatus().-->
  <!--function statusChangeCallback(response) {-->
    <!--console.log('statusChangeCallback');-->
    <!--console.log(response);-->
    <!--// The response object is returned with a status field that lets the-->
    <!--// app know the current login status of the person.-->
    <!--// Full docs on the response object can be found in the documentation-->
    <!--// for FB.getLoginStatus().-->
    <!--if (response.status === 'connected') {-->
      <!--// Logged into your app and Facebook.-->
      <!--testAPI();-->
        <!--location.reload()-->
    <!--} else {-->
      <!--// The person is not logged into your app or we are unable to tell.-->
      <!--$('body').show()-->
    <!--}-->
  <!--}-->

  <!--// This function is called when someone finishes with the Login-->
  <!--// Button.  See the onlogin handler attached to it in the sample-->
  <!--// code below.-->
  <!--function checkLoginState() {-->
    <!--FB.getLoginStatus(function(response) {-->
      <!--statusChangeCallback(response);-->
    <!--});-->
  <!--}-->

  <!--window.fbAsyncInit = function() {-->
  <!--FB.init({-->
    <!--appId      : '769242713247780',-->
    <!--cookie     : true,  // enable cookies to allow the server to access-->
                        <!--// the session-->
    <!--xfbml      : true,  // parse social plugins on this page-->
    <!--version    : 'v2.8' // use graph api version 2.8-->
  <!--});-->
<!--//  }-->

  <!--// Now that we've initialized the JavaScript SDK, we call-->
  <!--// FB.getLoginStatus().  This function gets the state of the-->
  <!--// person visiting this page and can return one of three states to-->
  <!--// the callback you provide.  They can be:-->
  <!--//-->
  <!--// 1. Logged into your app ('connected')-->
  <!--// 2. Logged into Facebook, but not your app ('not_authorized')-->
  <!--// 3. Not logged into Facebook and can't tell if they are logged into-->
  <!--//    your app or not.-->
  <!--//-->
  <!--// These three cases are handled in the callback function.-->

  <!--FB.getLoginStatus(function(response) {-->
    <!--statusChangeCallback(response);-->
  <!--});-->
<!--//-->


  <!--};-->
<!--//-->
<!--//  // Load the SDK asynchronously-->
  <!--(function(d, s, id) {-->
    <!--var js, fjs = d.getElementsByTagName(s)[0];-->
    <!--if (d.getElementById(id)) return;-->
    <!--js = d.createElement(s); js.id = id;-->
    <!--js.src = "//connect.facebook.net/en_US/sdk.js";-->
    <!--fjs.parentNode.insertBefore(js, fjs);-->
  <!--}(document, 'script', 'facebook-jssdk'));-->
<!--//-->
  <!--// Here we run a very simple test of the Graph API after login is-->
  <!--// successful.  See statusChangeCallback() for when this call is made.-->
  <!--function testAPI() {-->
    <!--console.log('Welcome!  Fetching your information.... ');-->
    <!--FB.api('/me?fields=email', function(response) {-->
        <!--console.log(response)-->
<!--//      console.log('Successful login for: ' + response.name);-->
<!--//      document.getElementById('status').innerHTML =-->
<!--//        'Thanks for logging in, ' + response.name + '!';-->

    <!--});-->

  <!--}-->

<!--//-->
<!--//    checkLoginState()-->
<!--</script>-->

    <script type="text/javascript">

    function nFormatter(num, digits) {
          var si = [
//            { value: 1E18, symbol: "E" },
//            { value: 1E15, symbol: "P" },
//            { value: 1E12, symbol: "T" },
            { value: 1E9,  symbol: "B" },
            { value: 1E6,  symbol: "M" },
            { value: 1E3,  symbol: "k" }
          ], rx = /\.0+$|(\.[0-9]*[1-9])0+$/, i;
          for (i = 0; i < si.length; i++) {
            if (num >= si[i].value) {
              return (num / si[i].value).toFixed(digits).replace(rx, "$1") + si[i].symbol;
            }
          }
          return num.toFixed(digits).replace(rx, "$1");
        }

        function nFormatterWrapper(num) {
            return nFormatter(num,3);
        }

      var newest_pii={{latest_pii|safe}};
      var newest_pii1 = {{latest_pii1|safe}};
      <!--var newest_clicked={{latest_clicked|safe}};-->

      var newest_rest={{latest_rest|safe}}; 

      var rare_adv={{rare_advertisers|safe}};
      var rare_adv_pii={{rare_advertisers_pii|safe}};

	var num_adv_pii = {{num_adv_pii|safe}};
	var num_adv_remarketing = {{num_adv_remarketing|safe}};
        var num_adv_rest  = {{num_adv_rest|safe}};
      
      var currpage_adv_pii = -1;
      var currpage_adv_pii1 = -1;
      var currpage_adv_rest = -1;
      var currpage_rare_adv = -1;
      var currpage_rare_adv_pii = -1;
      var currpage_rare_adv_targeting = -1;

      var pageSize = 5;

      var rare_adv_targeting = {{rare_advertisers_targeting|safe}};

	function render_total_adv(){
		html ="";
		if (num_adv_rest > 0)
			html += "<h4>Number of advertisers who targeted you: "+ (num_adv_rest) +" </h4>";
		
		if (num_adv_remarketing > 0)
			html += "<h4>Number of advertisers whose website or app you used : "+ num_adv_remarketing +" </h4>";
	
		if (num_adv_pii > 0)
			html += "<h4>Number of advertisers who have your contact info (mail, phone, address, etc): "+ num_adv_pii +" </h4>";

		$('#total_adv').html(html);
	}


      function load_next_adv_pii(n=5,direction=1){
         html="";
	if(currpage_adv_pii == 0 && direction == -1) return;
        currpage_adv_pii += direction;
	var startIdx = currpage_adv_pii * pageSize;

	var count = 4;
	n++;
	function doReq(count){
      	
		$.post('get_next_adv_pii',{'start':startIdx,'num_adv':n},
	function(data){
	if(data.status == 'success'){
        var next_adv_pii = JSON.parse(data.adv_pii);
	if(currpage_adv_pii > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii(5,-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	
	
	var end = (next_adv_pii.length < pageSize) ? next_adv_pii.length : pageSize;
        for (var x=0;x<end;x++)
        {
                 html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+next_adv_pii[x]['advertiser_id']+",\""+ next_adv_pii[x]['name']+"\",\" " + next_adv_pii[x]['facebook_page']+"\",\" "+next_adv_pii[x]['logo']+"\")' src=\""+next_adv_pii[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+next_adv_pii[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+next_adv_pii[x]['category']+"</p></div>";
       
	}
	if(next_adv_pii.length > pageSize)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii(5,1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        $('#newest_pii').empty();
        $('#newest_pii').append(html);        
	}
	
	if (data.reason==='Cookie') {
             console.log('Cookie problem. Redoing the request')
             count--;
             if (count>0) {
                   doReq(count);
                   return
                  }
              	}
	});
	};

	doReq(count);
      
      }


      function load_next_adv_pii1(n=5,direction=1){
         html="";
	if(currpage_adv_pii1 == 0 && direction == -1) return;
        currpage_adv_pii1 += direction;
	var startIdx = currpage_adv_pii1 * pageSize;

	var count = 4;
	n++;
	function doReq(count){
      	
		$.post('get_next_adv_webapp_pii1',{'start':startIdx,'num_adv':n},
	function(data){
	if(data.status == 'success'){
        var next_adv_pii = JSON.parse(data.adv_pii);
	if(currpage_adv_pii1 > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii1(5,-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	
	
	var end = (next_adv_pii.length < pageSize) ? next_adv_pii.length : pageSize;
        for (var x=0;x<end;x++)
        {
                 html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+next_adv_pii[x]['advertiser_id']+",\""+ next_adv_pii[x]['name']+"\",\" " + next_adv_pii[x]['facebook_page']+"\",\" "+next_adv_pii[x]['logo']+"\")' src=\""+next_adv_pii[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+next_adv_pii[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+next_adv_pii[x]['category']+"</p></div>";
       
	}
	if(next_adv_pii.length > pageSize)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii1(5,1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        $('#newest_pii1').empty();
        $('#newest_pii1').append(html);        
	}
	
	if (data.reason==='Cookie') {
             console.log('Cookie problem. Redoing the request')
             count--;
             if (count>0) {
                   doReq(count);
                   return
                  }
              	}
	});
	};

	doReq(count);
      
      }


	function load_next_adv_rest(n=5,direction=1){
         html="";
	if(currpage_adv_rest == 0 && direction == -1) return;
        currpage_adv_rest += direction;
	var startIdx = currpage_adv_rest * pageSize;

	var count = 4;
	n++;
	function doReq(count){
      	
		$.post('get_next_adv_rest',{'start':startIdx,'num_adv':n},
	function(data){
	if(data.status == 'success'){
	next_adv_rest = JSON.parse(data.adv_rest);
	if(currpage_adv_rest > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_rest(5,-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	
	
	var end = (next_adv_rest.length < pageSize) ? next_adv_rest.length : pageSize;
        for (var x=0;x<end;x++)
        {
                 html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+next_adv_rest[x]['advertiser_id']+",\""+ next_adv_rest[x]['name']+"\",\" " + next_adv_rest[x]['facebook_page']+"\",\" "+next_adv_rest[x]['logo']+"\")' src=\""+next_adv_rest[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+next_adv_rest[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+next_adv_rest[x]['category']+"</p></div>";
       
	}
	if(next_adv_rest.length > pageSize)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_rest(5,1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        $('#newest_rest').empty();
        $('#newest_rest').append(html);        
	}
	
	if (data.reason==='Cookie') {
             console.log('Cookie problem. Redoing the request')
             count--;
             if (count>0) {
                   doReq(count);
                   return
                  }
              	}
	});
	};

	doReq(count);
      
      }

       function render_rare_adv(direction=1){
	  html="";
	
        if (rare_adv.length === 0)
        {
          html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";
        }

	if(currpage_rare_adv == 0 && direction == -1) return;
	currpage_rare_adv += direction;
	var start = currpage_rare_adv * 5;
	var end = (start + 5 < rare_adv.length) ? (start + 5) : rare_adv.length;
	if(currpage_rare_adv > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='render_rare_adv(-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        for (var x=start;x<end;x++)
        {
          <!--html += "<div class=\"col-md-2\"><a href=\""+rare_adv[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+rare_adv[x]['logo']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Nb likes: </b> "+nFormatterWrapper(rare_adv[x]['category'])+"</p></div>";-->
        html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\"style='cursor:pointer' onclick='getAdvertiserInfo("+rare_adv[x]['advertiser_id']+",\""+ rare_adv[x]['name']+"\",\" " + rare_adv[x]['facebook_page']+"\",\" "+rare_adv[x]['logo']+"\")' src=\""+rare_adv[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Nb likes: </b> "+nFormatterWrapper(rare_adv[x]['category'])+"</p></div>";

        }
	if(end < rare_adv.length)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='render_rare_adv(1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	
        $('#rare_adv').empty();
        $('#rare_adv').append(html);

	}


    function render_rare_adv_pii(direction=1){
	  html="";
	
        if (rare_adv_pii.length === 0)
        {
          html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";
        }

	if(currpage_rare_adv_pii == 0 && direction == -1) return;
	currpage_rare_adv_pii += direction;
	var start = currpage_rare_adv_pii * 5;
	var end = (start + 5 < rare_adv_pii.length) ? (start + 5) : rare_adv_pii.length;
	if(currpage_rare_adv_pii > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='render_rare_adv_pii(-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        for (var x=start;x<end;x++)
        {
          <!--html += "<div class=\"col-md-2\"><a href=\""+rare_adv_pii[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+rare_adv_pii[x]['logo']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv_pii[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Nb likes: </b> "+nFormatterWrapper(rare_adv_pii[x]['category'])+"</p></div>";-->
        html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\"style='cursor:pointer' onclick='getAdvertiserInfo("+rare_adv_pii[x]['advertiser_id']+",\""+ rare_adv_pii[x]['name']+"\",\" " + rare_adv_pii[x]['facebook_page']+"\",\" "+rare_adv_pii[x]['logo']+"\")' src=\""+rare_adv_pii[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv_pii[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Nb likes: </b> "+nFormatterWrapper(rare_adv_pii[x]['category'])+"</p></div>";

        }
	if(end < rare_adv_pii.length)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='render_rare_adv_pii(1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	
        $('#rare_adv_pii').empty();
        $('#rare_adv_pii').append(html);

	}

   function render_rare_adv_targeting(direction = 1){
       if(currpage_rare_adv_targeting == 0 && direction == -1) return;
       currpage_rare_adv_targeting += direction;
       var start = currpage_rare_adv_targeting * pageSize;
       var end = (start + pageSize < rare_adv_targeting.length ) ? (start + pageSize) : rare_adv_targeting.length;
    html="";
       if (rare_adv_targeting.length === 0)
        {
          html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";
        }
	
    	if(currpage_rare_adv_targeting > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='render_rare_adv_targeting(-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        for (var x=start;x<end;x++)
        {
          <!--html += "<div class=\"col-md-2\"><a href=\""+rare_adv_targeting[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+rare_adv_targeting[x]['img_url']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv_targeting[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Number of users that have the targeting attributes: </b> "+nFormatterWrapper(rare_adv_targeting[x]['total_audience_size'])+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Targetting attributes: </b>"+rare_adv_targeting[x]['attributes']+"</p></div>";-->

          html += "<div class=\"col-md-2\"><img onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+rare_adv_targeting[x]['advertiser_id']+",\""+ rare_adv_targeting[x]['name']+"\",\" " + rare_adv_targeting[x]['facebook_page']+"\",\" "+rare_adv_targeting[x]['logo']+"\")' src=\""+rare_adv_targeting[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv_targeting[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Number of users that have the targeting attributes: </b> "+nFormatterWrapper(rare_adv_targeting[x]['total_audience_size'])+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Targetting attributes: </b>"+rare_adv_targeting[x]['attributes']+"</p></div>";

        }
    	if(end < rare_adv_targeting.length)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='render_rare_adv_targeting(1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	


        $('#rare_adv_targeting').empty();
        $('#rare_adv_targeting').append(html);
   }

      $(document).ready(function() {


        var html="";

        <!--if (newest_clicked.length === 0)-->
        <!--{-->
          <!--html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";-->
        <!--}        -->

        <!--for (var x=0;x<newest_clicked.length;x++)-->
        <!--{-->
          <!--&lt;!&ndash;html += "<div class=\"col-md-2\"><a href=\""+newest_clicked[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+newest_clicked[x]['logo']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 5px;\">"+newest_clicked[x]['name']+"</p><p style=\"font-size: 10px;text-align: center;margin-top: -9px;\"> Added on:"+newest_clicked[x]['category']+"</p></div>";&ndash;&gt;-->
          <!--html += "<div class=\"col-md-2\"><img onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+newest_clicked[x]['advertiser_id']+",\""+newest_clicked[x]['name']+"\",\" " + newest_clicked[x]['facebook_page']+"\",\" "+newest_clicked[x]['logo']+"\")' src=\""+newest_clicked[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 5px;\">"+newest_clicked[x]['name']+"</p><p style=\"font-size: 10px;text-align: center;margin-top: -9px;\"> Added on:"+newest_clicked[x]['category']+"</p></div>";-->

        <!--}-->
        <!--$('#newest_clicked').empty();-->
        <!--$('#newest_clicked').append(html);-->

        html="";

        if (newest_pii.length === 0)
        {
          html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";
        }      
     	else
		currpage_adv_pii = 0;

	if(currpage_adv_pii > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii(5,-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	
	
	var end = (newest_pii.length < pageSize) ? newest_pii.length : pageSize;
        for (var x=0;x<end;x++)
        {
        <!--<p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_pii[x]['type']+"</p><br>-->
          <!--html += "<div class=\"col-md-2\"><a href=\""+newest_pii[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+newest_pii[x]['logo']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+newest_pii[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_pii[x]['category']+"</p></div>";-->
            html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+newest_pii[x]['advertiser_id']+",\""+ newest_pii[x]['name']+"\",\" " + newest_pii[x]['facebook_page']+"\",\" "+newest_pii[x]['logo']+"\")' src=\""+newest_pii[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+newest_pii[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_pii[x]['category']+"</p></div>";
       
	}
	if(newest_pii.length > pageSize)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii(5,1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        $('#newest_pii').empty();
        $('#newest_pii').append(html);        

        
	
        html="";

        if (newest_pii1.length === 0)
        {
          html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";
        }      
     	else
		currpage_adv_pii1 = 0;

	if(currpage_adv_pii1 > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii1(5,-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	
	
	var end = (newest_pii1.length < pageSize) ? newest_pii1.length : pageSize;
        for (var x=0;x<end;x++)
        {
        <!--<p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_pii1[x]['type']+"</p><br>-->
          <!--html += "<div class=\"col-md-2\"><a href=\""+newest_pii1[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+newest_pii1[x]['logo']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+newest_pii1[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_pii1[x]['category']+"</p></div>";-->
            html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+newest_pii1[x]['advertiser_id']+",\""+ newest_pii1[x]['name']+"\",\" " + newest_pii1[x]['facebook_page']+"\",\" "+newest_pii1[x]['logo']+"\")' src=\""+newest_pii1[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+newest_pii1[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_pii1[x]['category']+"</p></div>";
       
	}
	if(newest_pii1.length > pageSize)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_pii1(5,1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        $('#newest_pii1').empty();
        $('#newest_pii1').append(html);        

	
	
	html="";

        if (newest_rest.length === 0)
        {
          html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";
        }
	else
		currpage_adv_rest = 0;
	

	if(currpage_adv_rest > 0)
		html += "<div class='col-md-1'><img src='static/prev48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_rest(5,-1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/prev48.png' style='margin-top:40px;opacity:0.5' /></div>";	
	var end = (newest_rest.length < pageSize) ? newest_rest.length : pageSize;
	for (var x=0;x<end;x++)
        {
          <!--html += "<div class=\"col-md-2\"><a href=\""+newest_rest[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+newest_rest[x]['logo']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+newest_rest[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_rest[x]['category']+"</p></div>";-->
          html += "<div class=\"col-md-2\"><img onerror=\"this.onerror=null;this.src='static/no-image.png';\" style='cursor:pointer' onclick='getAdvertiserInfo("+newest_rest[x]['advertiser_id']+",\""+ ((newest_rest[x]['name'] && (newest_rest[x]['name'][0]=="'")&& (newest_rest[x]['name'][newest_rest[x]['name'].length-1]=="'") )?newest_rest[x]['name'].slice(1,-1):newest_rest[x]['name'])+"\",\" " + newest_rest[x]['facebook_page']+"\",\" "+newest_rest[x]['logo']+"\")' src=\""+newest_rest[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+newest_rest[x]['name']+"</p><p style=\"font-size: 8px;text-align: center;margin-top: -9px;\">"+newest_rest[x]['category']+"</p></div>";

        }
	if(newest_rest.length > pageSize)
		html += "<div class='col-md-1'><img src='static/next48.png' style='cursor:pointer;margin-top:40px' onclick='load_next_adv_rest(5,1)'/></div>";	
	else
		html += "<div class='col-md-1'><img src='static/next48.png' style='margin-top:40px;opacity:0.5' /></div>";	

        $('#newest_rest').empty();
        $('#newest_rest').append(html);

	render_rare_adv();
  	render_rare_adv_pii();	
	render_total_adv();
   //     html="";

   //     if (rare_adv_pii.length === 0)
   //     {
   //       html+="<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No such advertisers!</p></div>";
   //     }

   //     for (var x=0;x<rare_adv_pii.length;x++)
   //     {
   //       <!--html += "<div class=\"col-md-2\"><a href=\""+rare_adv_pii[x]['facebook_page']+"\" target=\"_blank\"><img src=\""+rare_adv_pii[x]['logo']+"\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv_pii[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Nb likes: </b> "+nFormatterWrapper(rare_adv_pii[x]['category'])+"</p></div>";-->
   //     html += "<div class=\"col-md-2\"><img  onerror=\"this.onerror=null;this.src='static/no-image.png';\"style='cursor:pointer' onclick='getAdvertiserInfo("+rare_adv_pii[x]['advertiser_id']+",\""+ rare_adv_pii[x]['name']+"\",\" " + rare_adv_pii[x]['facebook_page']+"\",\" "+rare_adv_pii[x]['logo']+"\")' src=\""+rare_adv_pii[x]['logo']+"\" height=\"150\" width=\"150\"/><p style=\"font-size: 12px;text-align: center;margin-top: 2px;\">"+rare_adv_pii[x]['name']+"</p><p style=\"font-size: 12px;text-align: center;margin-top: -9px;\"> <b> Nb likes: </b> "+nFormatterWrapper(rare_adv_pii[x]['category'])+"</p></div>";

   //     }
   //     $('#rare_adv_pii').empty();
   //     $('#rare_adv_pii').append(html);

     	  render_rare_adv_targeting();

      });           
    </script>

    <script type="text/javascript">
        google.charts.load('current', {'packages':['geochart','corechart','bar','treemap']});
        google.charts.setOnLoadCallback(drawMap);
        function drawMap() {
          var locs={{locs|safe}};

          locs.splice(0, 0,["Country","# ads",{type: 'string', role: 'tooltip'}]);
          var data = google.visualization.arrayToDataTable(locs);
          
          var options = {
            height:350,
            width:470,
            legend: 'none',
            colorAxis: {
              colors:['#009933','#006600']
            },
            magnifyingGlass: {enable: true, zoomFactor: 7.5}            
          };
          options['dataMode'] = 'regions';

          var container = document.getElementById('ad_loc');
          var geomap = new google.visualization.GeoChart(container);

          geomap.draw(data, options);
        };
      </script>


      <!-- How I'm targeted donut -->
      <!--<script type="text/javascript">-->
          <!--google.charts.load("current", {packages:["corechart"]});-->
          <!--google.charts.setOnLoadCallback(drawChartDonut);-->

          <!--function donutReq(count,type) {-->
            <!--var getAdvsForExpl='get_advs_for_expl';-->
            <!--$('#top-objects-targ').hide();-->
            <!--$.post(getAdvsForExpl,{"type":String(type)}, -->
              <!--function(resp) {-->
                <!--if (resp.status==='success') {-->
                    <!--// console.log(resp.advertisers);-->
                    <!--var top_advertisers=resp.advertisers;                      -->
                    <!--$("#top-objects-targ").empty();-->

                    <!--if (top_advertisers.length==0){-->
                      <!--var html="<div class=\"col-md-12\" style=\"text-align:center;margin-top:25%\"><p>No advertisers available yet!</p><br/><br/>";-->
                      <!--$("#top-objects-targ").append(html);-->
                      <!--$("#top-objects-targ").show("slow");                      -->
                      <!--return;-->
                    <!--}-->

                    <!--var html="<div class=\"col-md-12\" style=\"text-align:center\"><h5>Top advertisers targeting me using "+type+"</h5><br/><br/>";-->

                    <!--for (var i=0;i<top_advertisers.length;i++)-->
                    <!--{-->
                      <!--html+="<div class=\"col-md-3\"><a href=\"https://www.facebook.com/"+top_advertisers[i]['facebook_page']+"\" target=\"_blank\"><img src=\""-->
                      <!--if (top_advertisers[i]['logo'] != null) {-->
                        <!--html += top_advertisers[i]['logo'];-->
                      <!--}-->
                      <!--else {-->
                        <!--html += "http://defense.hughes.com/images/missing-visual.png";-->
                      <!--}-->
                      <!--html+="\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;\">"+top_advertisers[i]['name']+"</p><p style=\"font-size: 8px;\"> Number of ads: "+top_advertisers[i]['freq']+"</p></div>";-->
                    <!--}-->
    <!---->
                  <!--html+="<br/><br/><br/><br/><br/><br/><br/><br/>";            -->
                  <!--$("#top-objects-targ").append(html);-->
                  <!--$("#top-objects-targ").show("slow");-->
                    <!--return          -->
                  <!--}-->
            <!---->
                <!--if (data.reason==='Cookie') {-->
                    <!--console.log('Cookie problem. Redoing the request')-->
                    <!--count&#45;&#45;;-->
                    <!--if (count>0) {-->
                        <!--donutReq(count,data,cat);-->
                        <!--return-->
                    <!--}-->
                <!--}              -->
              <!--}) -->
            <!--};-->

          <!--var data_map={{ov_divs|safe}};-->
          <!---->
          <!--function selectHandler(e) {-->
            <!--var data = google.visualization.arrayToDataTable({{overview|safe}});-->

            <!--var selection=chart.getSelection();-->
            <!--var type=data['og'][selection[0]['row']]['c'][0]['v'];            -->
            <!--if (selection.length === 0)-->
            <!--{-->
              <!--$('#donutchart').removeClass("col-md-3");-->
              <!--$('#donutchart').addClass("col-md-12");-->
              <!--// $('html,body').animate({scrollTop: $("#donutchart").offset().top},'slow');          -->
            <!--}-->
            <!--else-->
            <!--{-->
              <!--$('#donutchart').removeClass("col-md-12");              -->
              <!--$('#donutchart').addClass("col-md-3");-->
              <!--$('#b1').show();-->

              <!--var options = {-->
                <!--pieHole: 0.4,-->
                <!--pieSliceText: 'none',-->
                <!--legend:'none'-->
              <!--};              -->

              <!--chart = new google.visualization.PieChart(document.getElementById('donutchart'));-->
              <!--chart.draw(data, options);  -->
              <!--google.visualization.events.addListener(chart, 'select', selectHandler); -->
              <!---->
              <!--donutReq(4,type);-->
              <!---->
              <!--// $("#"+data_map[selection[0]['row']+1]).show("slow")-->
            <!--}-->
          <!--} -->

          <!--function drawChartDonut() {-->
            <!--$('#b1').hide("slow");-->
            <!--$('#top-objects-targ').hide();-->
            <!--$('#donutchart').removeClass("col-md-3");-->
            <!--$('#donutchart').addClass("col-md-12");-->

            <!--for (var x=0;x<10;x++)-->
              <!--{ -->
                <!--$("#"+data_map[x+1]).hide();-->
              <!--}          -->

            <!--var data = google.visualization.arrayToDataTable({{overview|safe}});-->


            <!--var options = {-->
              <!--pieHole: 0.4,-->
              <!--pieSliceText: 'none'-->
            <!--};-->

            <!--chart = new google.visualization.PieChart(document.getElementById('donutchart'));-->
            <!--chart.draw(data, options);-->
            <!--google.visualization.events.addListener(chart, 'select', selectHandler);  -->
          <!--}-->
      <!--</script>-->
               
    <script type="text/javascript">
        //google.charts.load("current", {packages:["corechart"]});
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
          var data = google.visualization.arrayToDataTable({{ages|safe}});

          var view = new google.visualization.DataView(data);

          var options = {
            width: 700,
            height: 370,
            bar: {groupWidth: "100%"},
            legend: { position: "none" },
          hAxis: {
                title: 'Age group'
              }
          };
          var chart = new google.visualization.ColumnChart(document.getElementById("age_range"));
          chart.draw(view, options);
      }
    </script>      

    <script type="text/javascript">
      //google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      var exp_cats_daily = {{exp_cats_daily|safe}}
      //console.log(exp_cats_daily);
      for (let i=1;i<exp_cats_daily.length;i++) {
            exp_cats_daily[i][0] = new Date(exp_cats_daily[i][0])
        }

      function drawChart() {
        var data = google.visualization.arrayToDataTable(exp_cats_daily);

        var options = {
        isStacked: 'relative',
        height: 500,
        legend: {position: 'top', maxLines: 3},
        vAxis: {
          minValue: 0,
          ticks: [0, .25, .5, .75, 1]
        },
        hAxis: {              gridlines: {
          color: 'transparent'
          }},
        areaOpacity:1
        };          

        var chart = new google.visualization.SteppedAreaChart(document.getElementById('area_plot'));
        chart.draw(data, options);
      }
    </script>

    <script type="text/javascript">
        //google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart2);

//        function createCustomReport(date) {
//          return '<div class="pre-scrollable container" style="padding:5px 5px 5px 5px;width:300px;height:400px">'+
//          '<h5> Likes for '+$.format.date(date,"ddd, MMM, D, yyyy") +' </h5>'+
//         '<hr style="width: 100%; color: black; height: 1px; background-color:black;" />'+
//         
//            '<h6 class="text-primary">Total: 232 </h6> '+
//
//          '<h6 class="text-success">New likes: </h6> '+
//          
//
//          '<ul class="list-group">'+
//            '<li class="list-group-item">Game Of Thrones</li>'+
//           ' <li class="list-group-item">Grimm</li>'+
//            '<li class="list-group-item">Attack On Titan</li>'+
//          '</ul>'+
//          
//            '<h6 class="text-danger">Removed likes: </h6>'+
//          
//
//          '<ul class="list-group">'+
//            '<li class="list-group-item">Pawn Stars</li>'+
//            '<li class="list-group-item">Mortal Kombat</li>'+
//          '</ul>'+
//
//        '</div>'
//        }
        
                       function createCustomReport(date,name,added) {
//                   console.log(date,name,added)
          var html ='<div class="pre-scrollable container" style="padding:5px 5px 5px 5px;width:300px;height:400px">'+
//          '<h5> '+name+' for '+$.format.date(new Date(date),"ddd, MMM, D, yyyy") +' </h5>'+
                        '<h5> '+name+' for '+date +' </h5>'+

         '<hr style="width: 100%; color: black; height: 1px; background-color:black;" />'
         
//            '<h6 class="text-primary">Total: '+total_number+' </h6> ';
        if (added.length>0) {
            html+='<h6 class="text-success">New '+name+': </h6> '+
          

          '<ul class="list-group">';
            for (let i=0;i<added.length;i++) {
                if (added[i].constructor === Array){
                  html+= '<li class="list-group-item"><a target="_blank" href="https://www.facebook.com/'+added[i][1]+'">'+ added[i][0] +'</a></li>';
                }
                else{
                  html+= '<li class="list-group-item">'+ added[i] +'</li>';                  
                }
            }

          html+='</ul>';
        }
        

        

        html+='</div>';
        return html
        }


        function drawChart2() {
        var data = {{advertisers_diffs|safe}};

        if (data.length<2) {

            var errMsg = "<div class='col-md-4 col-md-offset-5' style='margin-top:50px;margin-bottom:40px'><p style='font-size:15px'>No advertiser data for a timeline!</p></div>";
            document.getElementById('chart_div2').innerHTML = errMsg;

          return
        }



          var dataViz = google.visualization.arrayToDataTable(data);

          var options = {
        legend: { position: 'top' },
        height: 300,
        vAxis: { 
          textPosition: 'none',
          viewWindow: {
              max:0.3,
            min:3
          },
      gridlines: {
          color: 'transparent'
          }},
      tooltip: { isHtml: true,trigger: 'both' },
            pointSize: 15,
            pointShape: 'circle'
          };

          var chart = new google.visualization.ScatterChart(document.getElementById('chart_div2'));

          chart.draw(dataViz, options);
        }
           
        var  likeReport = {newEntries:['Game Of Thrones','Pokemon'],oldEntries:['Series'],total:250}
    </script>

    <script type="text/javascript">


       function doAdvReq(count,type,cat) {


            var getAdvsForCategory='get_advs_for_user';

            if (type=='top') {
              getAdvsForCategory = 'get_advs_for_user';
            }

            if (type=='primary') {
              getAdvsForCategory='get_advs_for_primary_category';
            }

            if (type=='secondary') {
              getAdvsForCategory='get_advs_for_secondary_category';

            }

            // $.post(getAdvsForCategory,{"cat":cat,"user_id":{{user_id|safe}}},
            $.post(getAdvsForCategory,{"cat":cat},

          function(resp) {
            if (resp.status==='success') {
                // console.log(resp.advertisers);
                var top_advertisers=resp.advertisers;
                // console.log(top_advertisers);
                $("#top-objects").hide();
                $("#top-objects").empty();
                var html="<div class=\"col-md-12\" style=\"text-align:center\"><h5>Top <b>" + cat + " advertisers </b> you are targeted by</h5><br/><br/>";

            for (var i=0;i<top_advertisers.length;i++)
            {
              html+="<div class=\"col-md-3\"><img src=\""
              if (top_advertisers[i]['logo'] != null) {
                html += top_advertisers[i]['logo'];
              }
              else {
                html += "static/no-image.png";
              }
              html+="\" height=\"150\" width=\"150\"/ style='cursor:pointer' onerror=\"this.onerror=null;this.src='static/no-image.png';\" onclick='getAdvertiserInfo("+top_advertisers[i]['advertiser_id']+",\""+((top_advertisers[i]['name'] && (top_advertisers[i]['name'][0]=="'")&& (top_advertisers[i]['name'][top_advertisers[i]['name'].length-1]=="'") )?top_advertisers[i]['name'].slice(1,-1):top_advertisers[i]['name'])+"\",\" " + top_advertisers[i]['facebook_page']+"\",\" "+top_advertisers[i]['logo']+"\")' ><p style=\"font-size: 12px;\">"+top_advertisers[i]['name']+"</p><p style=\"font-size: 8px;\"> Number of ads: "+top_advertisers[i]['freq']+"</p></div>";
            }
            html+="<br/><br/><br/><br/><br/><br/><br/><br/>";
            $("#top-objects").append(html);
            $("#top-objects").show("slow");
              return
            }

            if (resp.reason==='Cookie') {
                console.log('Cookie problem. Redoing the request')
                count--;
                if (count>0) {
                    doAdvReq(count,type,cat);
                    return
                }
            }

        }) };

      google.charts.setOnLoadCallback(drawChartTree);
      function drawChartTree() {
        var treeData = google.visualization.arrayToDataTable({{advertisers_tree|safe}});
        var treeMapContainer = document.getElementById('tree_map')
        tree = new google.visualization.TreeMap(treeMapContainer);
     function selectTreeHandler(e) {
     console.log(e);
      var selectedItem = tree.getSelection()[0];
    //console.log(selectedItem)
   		 if (selectedItem) {
          var value = treeData.getValue(selectedItem.row,0);
          var parent = treeData.getValue(selectedItem.row,1);
          if (value==='Advertiser Category') {
            console.log('get top advertisers');

            doAdvReq(3,'top','');
            return
          }

          if (parent==='Advertiser Category') {
            console.log('Get primary category advertisers');
            doAdvReq(3,'primary',value);
            return
          }

          console.log('Get secondary level advertisers');
          doAdvReq(3,'secondary',value);
        //alert('The user selected ' + value);
      }
      }

      function readyHandler() {
      //console.log('ready');
      doAdvReq(3,'top','');
      }

  // Listen for the 'select' event, and call my function selectHandler() when
  // the user selects something on the chart.
      google.visualization.events.addListener(tree, 'select', selectTreeHandler);
      google.visualization.events.addListener(tree, 'ready', readyHandler);

        tree.draw(treeData, {
         highlightOnMouseOver: true,
        maxDepth: 1,
        maxPostDepth: 2,
        minHighlightColor: '#8c6bb1',
        midHighlightColor: '#9ebcda',
        maxHighlightColor: '#edf8fb',
        minColor: '#009688',
        midColor: '#f7f7f7',
        maxColor: '#ee8100',
        //minColor: '#4c9d49',
        //midColor: '#ededdc',
        //maxColor: '#960038',
        headerHeight: 15,
        showScale: true,
        height: 500,
        useWeightedAverageForAggregation: true,
        textStyle: {
          fontSize: 20,
          bold: true,
          }
        });


      }


    </script>


    <!--<script type="text/javascript">-->
        <!--// top_advertisers['explanations'] = {{top_ads_expl|safe}}-->
        <!--// top_advertisers['categories'] = {{top_advertisers_cat|safe}}-->

        <!--var data_map_expl = {{ov_divs|safe}}-->
        <!---->
        <!--var data_cat;-->
        <!--var sec_title_map;-->
        <!--var sec_cat_data;-->
        <!--//google.charts.load("current", {packages:["corechart"]});-->
        <!--google.charts.setOnLoadCallback(drawChartDonutPrimaryCat);        -->
        <!--var prev_sel="";-->
        <!---->
        <!--function closeDonutAds(){-->
            <!--$("#top-objects").hide("slow");-->
            <!--$("#top-objects").empty();-->
            <!--$('html,body').animate({scrollTop: $("#donut_cat").offset().top}, 'slow');-->
            <!--chart_cat.setSelection();-->
        <!--}-->

        <!--function createLoader(){-->
          <!--$('#top-objects').hide();-->
          <!--$('#top-objects').html('<div class = "jumbotron " style="height:250px;"><div class="col-md-offset-5 centerme loader"></div></div>');-->
          <!--$('#top-objects').show();-->
            <!--// $('html,body').animate({scrollTop: $("#objects").offset().top}, 'slow');       -->
        <!--}        -->

        <!--function createLoaderDonut(){-->
          <!--$('#donut_cat').hide();-->
          <!--$('#donut_loader').html('<div class = "jumbotron " style="height:250px;"><div class="col-md-offset-5 centerme loader"></div></div>');-->
          <!--$('#donut_loader').show();-->
            <!--// $('html,body').animate({scrollTop: $("#objects").offset().top}, 'slow');       -->
        <!--}        -->

        <!--function doReq(count,cat) {-->
            <!--var getAdvsForCategory='get_advs_for_category';-->
            <!---->
            <!--// $.post(getAdvsForCategory,{"cat":cat,"user_id":{{user_id|safe}}},-->
            <!--$.post(getAdvsForCategory,{"cat":cat},-->
          <!---->
          <!--function(resp) {-->
            <!--if (resp.status==='success') {-->
                <!--// console.log(resp.advertisers);-->
                <!--var top_advertisers=resp.advertisers;     -->
                <!--// console.log(top_advertisers);-->
                <!--$("#top-objects").hide();-->
                <!--$("#top-objects").empty();-->
                <!--var html="<div class=\"col-md-12\" style=\"text-align:center\"><h5>Top " + cat + " advertisers I'm targeted by</h5><br/><br/>";-->

            <!--for (var i=0;i<top_advertisers.length;i++)-->
            <!--{-->
              <!--html+="<div class=\"col-md-3\"><a href=\"https://www.facebook.com/"+top_advertisers[i]['facebook_page']+"\" target=\"_blank\"><img src=\""-->
              <!--if (top_advertisers[i]['logo'] != null) {-->
                <!--html += top_advertisers[i]['logo'];-->
              <!--}-->
              <!--else {-->
                <!--html += "http://defense.hughes.com/images/missing-visual.png";-->
              <!--}-->
              <!--html+="\" height=\"150\" width=\"150\"/></a><p style=\"font-size: 12px;\">"+top_advertisers[i]['name']+"</p><p style=\"font-size: 8px;\"> Number of ads: "+top_advertisers[i]['freq']+"</p></div>";-->
            <!--}-->
            <!--html+="<br/><br/><br/><br/><br/><br/><br/><br/>";            -->
            <!--$("#top-objects").append(html);-->
            <!--$("#top-objects").show("slow");-->
              <!--return          -->
            <!--}-->
        <!---->
            <!--if (resp.reason==='Cookie') {-->
                <!--console.log('Cookie problem. Redoing the request')-->
                <!--count&#45;&#45;;-->
                <!--if (count>0) {-->
                    <!--doReq(count,cat);-->
                    <!--return-->
                <!--}-->
            <!--}-->
            <!---->
        <!--}) };-->

        <!--function doSecReq(count,cat) {-->
            <!--var getAdvsForCategory='get_advs_for_sec_category';-->
            <!--// $.post(getAdvsForCategory,{"cat":cat,"user_id":{{user_id|safe}}},-->
            <!--$.post(getAdvsForCategory,{"cat":cat},          -->
          <!--function(resp) {-->
            <!--if (resp.status==='success') {-->
                <!--// console.log(resp);-->
                <!--// console.log(resp.sec_data[1]);-->
                <!--var sec_data=google.visualization.arrayToDataTable(resp.sec_data[1]);-->
                <!--sec_title_map=resp.sec_data[2];-->
                <!--sec_cat_data=resp.sec_data[1];-->

                <!--$('#donut_loader').hide();                -->
                <!--$('#b2').show();-->
                <!--$('#donut_cat').show();-->

                <!--var options = {-->
                  <!--pieHole: 0.4,-->
                  <!--pieSliceText: 'none'-->
                <!--};            -->
                <!--// console.log(sec_data);-->
                <!--chart_cat = new google.visualization.PieChart(document.getElementById('donut_cat'));-->
                <!--chart_cat.draw(sec_data, options);-->
                <!--google.visualization.events.addListener(chart_cat, 'select', selectHandlerSecondaryCat);-->
                <!--// $('#donut_cat').show();                            -->
              <!--}-->
        <!---->
            <!--if (resp.reason==='Cookie') {-->
                <!--console.log('Cookie problem. Redoing the request')-->
                <!--count&#45;&#45;;-->
                <!--if (count>0) {-->
                    <!--doSecReq(count,cat);-->
                    <!--return-->
                <!--}-->
            <!--}-->
            <!---->
        <!--}) };-->

        <!--function selectHandlerPrimaryCat(e) {-->
          <!--createLoaderDonut();-->
          <!--var cat_title_map = {{adv_types|safe}};-->
          <!--// cat_title_map.pop();-->
          <!--for (var i=0;i<cat_title_map.length;i++) {-->
            <!--cat_title_map[i]=cat_title_map[i];-->
          <!--}-->
          <!--var selection_cat=chart_cat.getSelection();-->
          <!--// console.log(cat_title_map);-->

            <!--// $('#donut_cat').empty();-->
            <!--// $('#b2').show();-->

            <!--var options = {-->
              <!--pieHole: 0.4,-->
              <!--pieSliceText: 'none',-->
              <!--legend:'none'        -->
            <!--};            -->

            <!--var count = 4;-->
            <!--// console.log(cat_title_map[selection_cat[0]['row']]);-->
            <!--doSecReq(count,cat_title_map[selection_cat[0]['row']]);    -->
            <!--// createLoader();-->
        <!--}-->


        <!--function selectHandlerSecondaryCat(e) {-->
          <!--var cat_title_map = sec_title_map;-->
          <!--// cat_title_map.pop();-->
          <!--// console.log(cat_title_map);-->
          <!--for (var i=0;i<cat_title_map.length;i++) {-->
            <!--cat_title_map[i]=cat_title_map[i];-->
          <!--}-->
          <!--var selection_cat=chart_cat.getSelection();-->
          <!--// console.log(cat_title_map[selection_cat[0]['row']])-->

          <!--if (selection_cat.length === 0)-->
          <!--{-->
            <!--$("#top-objects").hide("slow");-->
            <!--$("#top-objects").empty();-->
            <!--$('#donut_cat').removeClass("col-md-3");-->
            <!--$('#donut_cat').addClass("col-md-12");-->
            <!--$('html,body').animate({scrollTop: $("#donut_cat").offset().top}, 'slow');-->
            <!--$('#b3').hide();-->
            <!--$('#b2').show();-->

          <!--}-->
          <!--else-->
          <!--{-->
            <!--$('#donut_cat').removeClass("col-md-12");-->
            <!--$('#donut_cat').addClass("col-md-3");-->
            <!--$('#b2').hide();-->
            <!--$('#b3').show();-->

            <!--var options = {-->
              <!--pieHole: 0.4,-->
              <!--pieSliceText: 'none',-->
              <!--legend:'none'        -->
            <!--};            -->

            <!--chart_cat = new google.visualization.PieChart(document.getElementById('donut_cat'));-->
            <!--sec_cat_data_plot = google.visualization.arrayToDataTable(sec_cat_data);-->
            <!--chart_cat.draw(sec_cat_data_plot, options);-->
            <!--google.visualization.events.addListener(chart_cat, 'select', selectHandlerSecondaryCat);   -->

            <!--var count = 4;-->
            <!--doReq(count,cat_title_map[selection_cat[0]['row']]);    -->
            <!--// createLoader();-->
          <!--}-->
        <!--}        -->


        <!--function drawChartDonutPrimaryCat() {-->
          <!--$('#b2').hide("slow");-->
          <!---->
          <!--$('#donut_cat').removeClass("col-md-3");-->
          <!--$('#donut_cat').addClass("col-md-12");-->
          <!--$('#top-objects').hide("slow");-->

          <!--donut_data={{advertiser_cat_overview|safe}};-->
          <!--// donut_data.pop();-->
          <!--// console.log(donut_data);-->
          <!--for (var i=0;i<donut_data.length;i++) {-->
            <!--// console.log(donut_data[i]);-->
            <!--if (donut_data[i][0]===null) {continue;}-->
            <!--donut_data[i][0]=donut_data[i][0];-->
          <!--}-->
          <!--data_cat = google.visualization.arrayToDataTable(donut_data);-->


          <!--var options = {-->
            <!--pieHole: 0.4,-->
            <!--pieSliceText: 'none',-->
            <!--height:450-->
          <!--};-->

          <!--chart_cat = new google.visualization.PieChart(document.getElementById('donut_cat'));-->
          <!--chart_cat.draw(data_cat, options);-->
          <!--google.visualization.events.addListener(chart_cat, 'select', selectHandlerPrimaryCat);       -->
        <!--}  -->

        <!--function drawChartDonutSecondaryCat() {-->
          <!--$('#b3').hide();-->
          <!--$('#b2').show();-->
          <!---->
          <!--$('#donut_cat').removeClass("col-md-3");-->
          <!--$('#donut_cat').addClass("col-md-12");-->
          <!--$('#top-objects').hide("slow");-->

          <!--// donut_data=sec_cat_data;-->
          <!--// // donut_data.pop();-->
          <!--// for (var i=0;i<donut_data.length;i++) {-->
          <!--//   donut_data[i][0]=donut_data[i][0];-->
          <!--// }-->
          <!--// data_cat = google.visualization.arrayToDataTable(donut_data);-->


          <!--var options = {-->
            <!--pieHole: 0.4,-->
            <!--pieSliceText: 'none',-->
            <!--height:450-->
          <!--};-->

            <!--chart_cat = new google.visualization.PieChart(document.getElementById('donut_cat'));-->
            <!--// console.log(sec_cat_data);-->
            <!--sec_cat_data_plot = google.visualization.arrayToDataTable(sec_cat_data);-->
            <!--chart_cat.draw(sec_cat_data_plot, options);-->
            <!--google.visualization.events.addListener(chart_cat, 'select', selectHandlerSecondaryCat);   -->

        <!--}                         -->
      <!---->
    <!--</script>    -->



      <!-- Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1137750199667219');
  fbq('track', 'PageView');
    fbq('track', 'ViewContent');


</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=1137750199667219&ev=PageView&noscript=1"
/></noscript>
  </head>

  <body>



    <script>

      function emptyAdvertisers() {
          $('#modalAdvertiserName').empty();
          $('#modalAdvertiserBody').empty();

          $('#modalAdvertiserBody').addClass('loader');
          $('#modalAdvertiserBody').addClass('col-centered');
      }

      function getAdvertiserInfo(advertiserId,advertiserName,webSite,img_url) {
      emptyAdvertisers();

      $('#advertiserModal').modal();

      $('#modalAdvertiserName').html('<h1>'+advertiserName+'<h1>')
            $.ajax({
      type:'POST',
      url:'get_advertiser_info',
      data: {'advertiser':advertiserId},
      success:function(resp){
      $('#modalAdvertiserBody').removeClass('loader');
      $('#modalAdvertiserBody').removeClass('col-centered');


          if (resp.status!=='success') {

            <!--show error message-->
            var html = '<div class="col-md-4"><div class="col-md-12 "> <img class="img-responsive" style="max-width: 100%;" src="'+img_url+'" > </div></div>';
            html += '<div class="col-md-8">'
            html+='<div class="col-md-12"> <b>Website: </b><a href="'+webSite+'" target="_blank">'+webSite+'</a></div> <br> <br>';
            html += '<div class=" col-md-12 alert alert-danger">Cannot retrieve more info for advertiser!</div> <br>';
            html += '</div>'
            $('#modalAdvertiserBody').html(html);

            return
          }



        var html = '<div class="col-md-4"><div class="col-md-12 "> <img class="img-responsive" style="max-width: 100%;" src="'+resp.info.img_url+'" > </div></div>';

         html += '<div class="col-md-8">'

        var website = resp.info.website?resp.info.website:advertiserName;

         html += '<div class="col-md-12"> <b>Website: </b><a href="'+website+'" target="_blank">'+website+'</a></div>';

          var advertiserPrimaryCategory = resp.info.primary_category?resp.info.primary_category+'/ ':''

          var advertiserCategory = resp.info.category?resp.info.category.slice(1,-1):'<span class="text-danger">Cannot retrieve category of advertiser..</span>'

          html+= '<div class="col-md-12"> <b>Advertiser category: </b>' +advertiserPrimaryCategory+advertiserCategory+'</div>'


          <!--html+= '<div class="col-md-12"> <b>Advertiser  category: </b>' +advertiserCategory+'</div>'-->


          var likes = resp.info.likes?nFormatterWrapper(resp.info.likes):'<span class="text-danger">Cannot retrieve likes of advertiser..</span>'
          html+= '<div class="col-md-12"> <b>Nb of likes: </b>' +likes+'</div>';

          var nbAds = resp.stats.adcount;
          html+= '<div class="col-md-12"> <b>Nb of ads you received: </b>' +nbAds+'</div>';


          var minDay = resp.stats.minday;
          var maxDay = resp.stats.maxday;

          if (minDay && maxDay) {
                      html+= '<div class="col-md-12"> <b>You received the first ad on: </b>' +minDay+'</div>';
                      html+= '<div class="col-md-12"> <b>You received the last ad on: </b>' +maxDay+'</div>';
          }


           if (resp.user_exps.length>0) {
           html+="<div class='col-md-12' > <b>The advertiser targeted <span class='text-danger'>you</span> with: </b>";
                     for (let j=0;j<resp.user_exps.length;j++) {
                        if (resp.user_exps[j][0]=='') {
                            html += resp.user_exps[j][1] + ", ";
                            continue;
                        }
                        html += resp.user_exps[j][0]+  " (" +resp.user_exps[j][1]+")" + ", ";
                     }
                            html = html.slice(0,-1);

            html += '</div>'

                 }



               if (resp.all_exps.length>0) {
           html+="<div class='col-md-12' > <b>The advertiser targeted <span class='text-danger'>other users</span> with: </b>";
                     for (let j=0;j<resp.all_exps.length;j++) {
                        if (resp.all_exps[j][0]=='') {
                            html += resp.all_exps[j][1] + ", ";
                            continue;
                        }
                        html += resp.all_exps[j][0]+  " (" +resp.all_exps[j][1]+")" + ", ";
                     }
            html = html.slice(0,-1);
            html += '</div>'

                 }

            html += '</div>'

                    var top_ads = resp.top_adv_ads;

        if (top_ads.length){
            html += '<br/> <div class="col-md-12" ><h3  > Top Ads: </h3></div>';

          html +='<ul class="list-group">';

            for (var i=0;i<top_ads.length;i++)
            {

                html+="<div class='col-md-12 list-group-item'><div class='col-md-4'><img src='"+top_ads[i]['img']+"' style='width:100%' ><br>"+top_ads[i]['name']+"</div><div class='col-md-8'><div class='col-md-12' > <b>Number of impressions: </b>" +top_ads[i]['noads']+ "</div>";
                 // html+="<div class='col-md-12' > <b>Explanation:</b> " +( (top_ads[i]['explanation'] && top_ads[i]['explanation']!='')?('<small>'+top_ads[i]['explanation']+'</small>'):'<span class="text-danger">Collecting the explanation for this advertisement..</span>')+ "</div>";

                // if (top_ads[i]['compact_explanation']) {
                //    html+=   "<div class='col-md-12' > <b>Compact explanation: </b>";
                //         if (top_ads[i]['compact_explanation'][0]=='') {
                //             html += top_ads[i]['compact_explanation'][1];
                //         }
                //         else {
                //         html += top_ads[i]['compact_explanation'][0]+  " (" +top_ads[i]['compact_explanation'][1]+")" ;}
                //     html+="</div> <br>";

                // }
                // 
                //    html+=   "<div class='col-md-12' > <b>Targeting types: </b>";
                //    
                html+=   "<div class='col-md-12' > <b>Targeting types: </b>";

                      if (top_ads[i]['is_waist']==false) {
                      if (top_ads[i]['compact_explanation']) {
                          if (top_ads[i]['compact_explanation'][0]=='') {
                              html += top_ads[i]['compact_explanation'][1];
                          }
                        else {
                              html += top_ads[i]['compact_explanation'][0]+  " (" +top_ads[i]['compact_explanation'][1]+")" ;}

                        } } else if (top_ads[i]['is_waist']==true) {

                          for (var waist_i=0;waist_i<top_ads[i]['compact_waist_explanations'].length;waist_i++) {
                              var waist_compact_exp =top_ads[i]['compact_waist_explanations'][waist_i]
                              html += waist_compact_exp[0][0]+  " (" +waist_compact_exp[1]+"), " ;}

                              if (top_ads[i]['compact_waist_explanations'].length!=0) {
                                html = html.substring(0,html.length-2)
                              }
                          }



                    html+="</div> <br>";


                if (top_ads[i]['expl_profile'].length!=0) {
                    html+="<div class='col-md-12' > <b>All users have received this ad for: </b>";
                     for (let j=0;j<top_ads[i]['expl_profile'].length;j++) {
                        if (top_ads[i]['expl_profile'][j][0]=='') {
                            html += top_ads[i]['expl_profile'][j][1] + ", ";
                            continue;
                        }
                        html += top_ads[i]['expl_profile'][j][0]+  " (" +top_ads[i]['expl_profile'][j][1]+")" + ", ";
                     }





                    html = html.slice(0,html.length-2);
                    html +="</div>";
                }


                if (top_ads[i]['is_waist']==false) {
                      html+="<div class='col-md-12' > <b>Facebook Explanation text</b> (available only for old-type explanations):  " +( (top_ads[i]['explanation'] && top_ads[i]['explanation']!='')?('<small>' + top_ads[i]['explanation']+'</small>'):'<span>Collecting...</span>')+ "</div>";
                  }





                html+="</div></div>";
//              html+="<div class='col-md-12'><div class='col-md-4'><img src='"+top_advertisers['categories'][sel_cat][i]['logo']+"' height='100' width='100'></div><div class='col-md-8'><div class='col-md-12'>"+top_advertisers['categories'][sel_cat][i]['name']+"</div><br/><br/><br/><div class='col-md-12' style='font-size:12px'> By: <a href ='"+top_advertisers['categories'][sel_cat][i]['advertiser_name']+"'>"+top_advertisers['categories'][sel_cat][i]['advertiser_name']+"<a/></div><div class='col-md-12' style='font-size:12px'> Count:" + top_advertisers['categories'][sel_cat][i]['freq'] + "</div></div></div><br/><hr>";
              html+="</div>"
            }
          html+='</ul>';
          }



        $('#modalAdvertiserBody').html(html);





      }})

      }

 

    </script>

  <div class="modal fade" id="advertiserModal" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" id="modalAdvertiserName"></h4>
        </div>
        <div class="modal-body" >
          <div class="row">
        <div class="loader col-centered "  id="modalAdvertiserBody">

          </div>
            </div>




        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>


    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="./view_data_about_me" class="navbar-brand"><img src="{% static "enabled_48.png" %}" height="50" width="50" style="float:left;margin-top:-15px">AdAnalyst</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="./view_data_about_me">Data</a></li>
            <li><a href="./view_advertisers">Advertisers</a></li>
          <li><a href="./view_all_ads.html">Ads</a></li>
	    <li><a href="./view_search_ads.html">Search</a></li>
            <li><a href="./contact_us.html">Contact us</a></li>

<!--            <li><a href="#">Advertisements</a></li>-->
<!--            <li><a href="#">Log Out</a></li>-->
          </ul>
        </div>
      </div>
    </div>

    <div class="container" style="margin-top: 100px">
      <div class="row">
        <!---->
        <!--<div class="col-md-12" style="margin-top: 40px">-->
          <!--<h3>Latest advertisers with my contact information</h3><hr>-->
          <!--<div class="col-md-12">-->
            <!--<div id="newest_pii"></div>-->
          <!--</div>-->
        <!--</div>       -->
        <!---->
        <!--<div class="col-md-12" style="margin-top: 40px">-->
          <!--<h3>Latest advertisers whose website or app I used</h3><hr>-->
          <!--<div class="col-md-12">-->
            <!--<div id="newest_clicked"></div>-->
          <!--</div>-->
        <!--</div>       -->



        <div class="col-md-12">
	  <h2>Advertisers</h2>
	  <div class='text-secondary' style="font-size:16px;margin-top:5px; margin-bottom: 15px">This page allows you to check which advertisers are targeting you</div> 
	  <div id='total_adv'></div>
	  <br>
          <hr>
		
	  <h3>New advertisers that are targeting you:</h3>
          <div class="col-md-12" style="margin-bottom:70px">
	                <div id="newest_rest"></div>
          </div>


	<h3>New advertisers that have your contact information:</h3>
        <div class="col-md-12" style="margin-bottom:70px">
          	  <small><a href="./contact_us">Contact us </a> if you didn't give your information to these advertisers</small> <br /><br/>
            <div id="newest_pii"></div>
          </div>

	<h3>New advertisers whose website or app you used:</h3>
        <div class="col-md-12" style="margin-bottom:70px">
          	  <small><a href="./contact_us">Contact us </a> if you didn't give your information to these advertisers</small> <br /><br/>
            <div id="newest_pii1"></div>
          </div>


        <h3>Timeline of new advertisers:</h3>
        <div id="chart_div2" style="margin-bottom:70px"></div>
        

	<h3>Unpopular advertisers targeting you</h3> 
	<span>Malicious advertisers are rarely popular, here is a list of the advertisers with the lowest number of likes that targeted you:</span><br><br>
          <div class="col-md-12" style="margin-bottom:70px">
           <div id="rare_adv"></div>
          </div>

	
         <h3>Advertisers with the lowest number of likes that have your contact information:</h3>
          <div class="col-md-12" style="margin-bottom:70">
            <div id="rare_adv_pii"></div>
          </div>


	
	<h3>Advertisers that use the most unique targeting</h3> 
        <div class="col-md-12" style="margin-bottom: 70px">
	<span>Advertisers can target people using infrequent attributes in order to reach a very specific
            audience (such microtargeting has been used in political ads to influence voters)!
	    These are the advertisers that have targeted you, using the most infrequent attributes. </span><br><br>
          
          <div class="col-md-12">
            <div id="rare_adv_targeting"></div>
          </div>
        </div>

   <h3>How are advertisers targeting you overall</h3> 
        <div class="col-md-12" style="margin-bottom: 10px">
		<h4>Advertisers use different types of info to target users (<a target="_blank" href="https://www.facebook.com/ads/about/">see more...</a>). Here is a summary of how you have been targeted:</h4>

          <!--<div id="b1" style="display:none;cursor: pointer;" onclick="drawChartDonut()">-->
            <!--<span class="glyphicon glyphicon-arrow-left" style="font-size: 25px;"></span>-->
          <!--</div>                -->
          <!--<div id="donutchart" style="height: 450px;" class="col-md-12"></div>        -->
            <!--<div class="col-md-8">-->
              <!--<div id="top-objects-targ"></div>-->
            <!--</div>                       -->
        <!--</div> -->
        
        <!--<div class="col-md-12">-->
          <!--<h3>How am I targeted by advertisers over time?</h3><hr>-->
          <div class="col-md-12">
            <div id="area_plot" style="margin-left:-55px;width: 1200px"></div>
          </div>          
        </div>

        <div class="col-md-12" >
          <div class="col-md-6">
            <h4>You received advertisements because you have visited</h4><hr>
            <div id="ad_loc" style="height: 350px;width: 470px"></div>            
          </div>
          <div class="col-md-6">
            <h4>You received advertisements that target users of the following ages</h4><hr>
            <div id="age_range" style="height: 350px;width: 1120px"></div>            
          </div>
        </div>

        <div class="col-md-12" style="margin-top: 40px">
          <h4>The type of advertisers that  are targeting you</h4><hr>
          <div class="col-md-12">
            <!--<p>The following categories of advertisers target me -use left and right (secondary click for MACs) mouse click to navigate:</p>-->
            <!--<div id="b2" style="display:none;cursor: pointer;" onclick="drawChartDonutPrimaryCat()">-->
              <!--<span class="glyphicon glyphicon-arrow-left" style="font-size: 25px;"></span>-->
            <!--</div>                -->
            <!--<div id="b3" style="display:none;cursor: pointer;" onclick="drawChartDonutSecondaryCat()">-->
              <!--<span class="glyphicon glyphicon-arrow-left" style="font-size: 25px;"></span>-->
            <!--</div>                -->

            <!--<div id="donut_cat"></div>-->
            <!--<div id="donut_loader"></div>-->
            <!---->
            <div id="tree_map"></div>

            <div class="col-md-12">
              <p class="text-danger">Left click to zoom-in/ Right click to zoom-out (two finger click in Mac) </p>
              <div id="top-objects" ></div>
            </div>               
          </div>
        </div>
      </div>
        <footer>
         <p>You can find more information on the host of this internet web site here : <a href="https://imprint.mpi-klsb.mpg.de/sws/adanalyst.mpi-sws.org">Imprint/Impressum</a> | <a href="https://data-protection.mpi-klsb.mpg.de/sws/adanalyst.mpi-sws.org">Data Protection</a>
 </p></footer>
    </div>


  </body>
</html>
